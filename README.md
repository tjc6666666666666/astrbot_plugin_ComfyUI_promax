# ğŸ¨ Astrbot ComfyUI Plugin Pro Max

[![Version](https://img.shields.io/badge/version-3.3-blue.svg)](https://github.com/tjc6666666666666/astrbot_plugin_ComfyUI_promax)
[![Python](https://img.shields.io/badge/python-3.10%2B-blue.svg)](https://www.python.org/)

[![AstrBot](https://img.shields.io/badge/AstrBot-compatible-orange.svg)](https://github.com/AstrBotDevs/AstrBot)

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ Astrbot æ’ä»¶ï¼Œé›†æˆäº† ComfyUI AI ç»˜ç”»åŠŸèƒ½ï¼Œæ”¯æŒæ–‡ç”Ÿå›¾ã€å›¾ç”Ÿå›¾ã€å¤šæœåŠ¡å™¨è½®è¯¢ã€æ¨¡å‹é€‰æ‹©ã€LoRA æ”¯æŒã€è‡ªå®šä¹‰ Workflowã€Web APIã€GUI ç®¡ç†ç•Œé¢ç­‰é«˜çº§åŠŸèƒ½ã€‚

## ğŸ“‹ ç›®å½•

- [âœ¨ ä¸»è¦ç‰¹æ€§](#-ä¸»è¦ç‰¹æ€§)
- [ğŸš€ å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [ğŸ“¦ å®‰è£…è¦æ±‚](#-å®‰è£…è¦æ±‚)
- [ğŸ“ ä½¿ç”¨æŒ‡å—](#-ä½¿ç”¨æŒ‡å—)
- [âš™ï¸ é…ç½®è¯´æ˜](#-é…ç½®è¯´æ˜)
- [ğŸ“‹ Workflow å¼€å‘æŒ‡å—](#-workflow-å¼€å‘æŒ‡å—)
- [ğŸ”§ é«˜çº§é…ç½®è¯¦è§£](#-é«˜çº§é…ç½®è¯¦è§£)
- [ğŸš€ éƒ¨ç½²æŒ‡å—](#-éƒ¨ç½²æŒ‡å—)
- [ğŸ› ï¸ æ•…éšœæ’é™¤](#ï¸-æ•…éšœæ’é™¤)
- [ğŸ¤ è´¡çŒ®æŒ‡å—](#-è´¡çŒ®æŒ‡å—)

> âš ï¸ **é‡è¦æç¤º**ï¼šå¦‚æœéœ€è¦ä½¿ç”¨å›¾ç‰‡åŠ å¯†åŠŸèƒ½ï¼Œè¯·å…ˆåœ¨ ComfyUI ä¸­å®‰è£…ä»¥ä¸‹è‡ªå®šä¹‰èŠ‚ç‚¹ï¼š
> - `hilbert_image_encrypt` - å¸Œå°”ä¼¯ç‰¹å›¾åƒåŠ å¯†èŠ‚ç‚¹
> - `image_compressor` - å›¾åƒå‹ç¼©å™¨èŠ‚ç‚¹
## âœ¨ ä¸»è¦ç‰¹æ€§

### ğŸ¯ AI ç»˜ç”»æ ¸å¿ƒåŠŸèƒ½
- **æ–‡ç”Ÿå›¾ (Text-to-Image)**ï¼šé€šè¿‡æ–‡å­—æè¿°ç”Ÿæˆé«˜è´¨é‡å›¾ç‰‡
- **å›¾ç”Ÿå›¾ (Image-to-Image)**ï¼šåŸºäºç°æœ‰å›¾ç‰‡è¿›è¡ŒäºŒæ¬¡åˆ›ä½œ
- **æ‰¹é‡ç”Ÿæˆ**ï¼šæ”¯æŒä¸€æ¬¡ç”Ÿæˆå¤šå¼ å›¾ç‰‡ï¼Œæé«˜æ•ˆç‡
- **å¤šæœåŠ¡å™¨è½®è¯¢**ï¼šæ™ºèƒ½åˆ†é…ä»»åŠ¡åˆ°å¤šä¸ª ComfyUI æœåŠ¡å™¨

### ğŸ› ï¸ é«˜çº§ç‰¹æ€§
- **ğŸ­ æ¨¡å‹é€‰æ‹©**ï¼šæ”¯æŒåˆ‡æ¢ä¸åŒçš„ AI æ¨¡å‹ï¼Œæ»¡è¶³ä¸åŒé£æ ¼éœ€æ±‚
- **âœ¨ LoRA æ”¯æŒ**ï¼šå¯ä½¿ç”¨å¤šä¸ª LoRA æ¨¡å‹å¢å¼ºæ•ˆæœ
- **ğŸ” å›¾ç‰‡åŠ å¯†**ï¼šå¸Œå°”ä¼¯ç‰¹æ›²çº¿å›¾åƒåŠ å¯†ä¿æŠ¤
- **ğŸ’¾ è‡ªåŠ¨ä¿å­˜**ï¼šç”Ÿæˆçš„å›¾ç‰‡è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°
- **ğŸ“¦ å‹ç¼©åŒ…ä¸‹è½½**ï¼šæ”¯æŒæ‰“åŒ…ä¸‹è½½å½“æ—¥ç”Ÿæˆçš„å›¾ç‰‡
- **ğŸ“š æ™ºèƒ½å¸®åŠ©ç³»ç»Ÿ**ï¼šæ”¯æŒæ–‡æœ¬å’Œå›¾ç‰‡å½¢å¼çš„å¸®åŠ©ä¿¡æ¯
- **âš™ï¸ è‡ªå®šä¹‰ Workflow**ï¼šæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰å·¥ä½œæµï¼Œæ‰©å±•åŠŸèƒ½æ— é™å¯èƒ½

### ğŸ¨ Workflow ç³»ç»Ÿ
- **å›¾åƒåŠ å¯†è§£å¯†**ï¼šå¸Œå°”ä¼¯ç‰¹æ›²çº¿åŠ å¯†/è§£å¯†å·¥ä½œæµ
- **å¹»å½±å¦å…‹ç”Ÿæˆ**ï¼šæ”¯æŒé»‘ç™½å’Œå½©è‰²ä¸¤ç§æ¨¡å¼çš„å¹»å½±å¦å…‹å›¾ç‰‡ç”Ÿæˆ
- **Wan2.2 åŠ¨ç”»ç”Ÿæˆ**ï¼šåŸºäºæ–‡æœ¬æç¤ºç”ŸæˆåŠ¨ç”»åºåˆ—
- **Hunyuan3D 3Dç”Ÿæˆ**ï¼šè…¾è®¯æ··å…ƒ3Dæ¨¡å‹ç”Ÿæˆ
- **éŸ³é¢‘è½¬åŠ¨ç”»**ï¼šAudio AceéŸ³é¢‘é©±åŠ¨çš„åŠ¨ç”»ç”Ÿæˆ
- **å¯æ‰©å±•æ¶æ„**ï¼šè½»æ¾æ·»åŠ æ–°çš„è‡ªå®šä¹‰å·¥ä½œæµ
- **ç»Ÿä¸€å¸®åŠ©ç³»ç»Ÿ**ï¼šæ¯ä¸ªå·¥ä½œæµéƒ½æœ‰è¯¦ç»†çš„å¸®åŠ©æ–‡æ¡£å’Œå›¾ç‰‡è¯´æ˜
- **å‚æ•°åˆ«åæ”¯æŒ**ï¼šæ”¯æŒä¸­è‹±æ–‡å‚æ•°åï¼Œä½¿ç”¨æ›´ä¾¿æ·
- **é…ç½®æ³¨å…¥åŠŸèƒ½**ï¼šè‡ªåŠ¨åŒæ­¥ä¸»ç¨‹åºçš„æ¨¡å‹ã€LoRAã€é‡‡æ ·å™¨é…ç½®
- **æ™ºèƒ½å‚æ•°éªŒè¯**ï¼šè‡ªåŠ¨éªŒè¯å‚æ•°ç±»å‹ã€èŒƒå›´å’Œå¿…éœ€æ€§
- **ç¼“å­˜æœºåˆ¶**ï¼šå¸®åŠ©å›¾ç‰‡è‡ªåŠ¨ç¼“å­˜ï¼Œæé«˜å“åº”é€Ÿåº¦

### ğŸŒ Web ç®¡ç†ç•Œé¢
- **Web API æ¥å£**ï¼šæä¾› RESTful API ç”¨äºç½‘é¡µé›†æˆ
- **é…ç½®ç®¡ç† GUI**ï¼šå¯è§†åŒ–é…ç½®ç®¡ç†ç•Œé¢
- **ç”¨æˆ·æ³¨å†Œç³»ç»Ÿ**ï¼šæ”¯æŒç”¨æˆ·æ³¨å†Œå’Œæƒé™ç®¡ç†
- **å†å²è®°å½•**ï¼šç”Ÿæˆå†å²è®°å½•å’Œä»»åŠ¡ç®¡ç†
- **å›¾ç‰‡ä»£ç†**ï¼šå®‰å…¨çš„å›¾ç‰‡è®¿é—®ä»£ç†æœåŠ¡

### ğŸ”§ ç³»ç»Ÿç®¡ç†åŠŸèƒ½
- **ä¸»åŠ¨æ’¤å›æ¶ˆæ¯**ï¼šå¯é…ç½®è‡ªåŠ¨æ’¤å›æœºå™¨äººå‘é€çš„æ–‡æœ¬æ¶ˆæ¯
- **ä¼ªé€ è½¬å‘æ¶ˆæ¯**ï¼šå½“å›¾ç‰‡æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ä»¥è½¬å‘æ¶ˆæ¯å½¢å¼å‘é€
- **ç¾¤èŠç™½åå•**ï¼šæ”¯æŒé™åˆ¶ç‰¹å®šç¾¤èŠä½¿ç”¨æ’ä»¶
- **æ—¶é—´æ®µæ§åˆ¶**ï¼šå¯è®¾ç½®æ’ä»¶å¼€æ”¾æ—¶é—´æ®µ
- **å¹¶å‘æ§åˆ¶**ï¼šæ¯ä¸ªç”¨æˆ·çš„æœ€å¤§å¹¶å‘ä»»åŠ¡æ•°é™åˆ¶
- **æ•°æ®åº“è®°å½•**ï¼šç”¨æˆ·ä¸‹è½½è®°å½•å’Œå›¾ç‰‡ç”Ÿæˆè®°å½•

## ğŸ“¦ å®‰è£…è¦æ±‚

### Python ä¾èµ–
```bash
pip install -r requirements.txt
```

**requirements.txt å†…å®¹ï¼š**
```txt
aiohttp>=3.8.0
Pillow>=9.0.0
aiofiles>=0.8.0
aiosqlite>=0.17.0
asyncio-throttle>=1.0.0
```

### ComfyUI ç¯å¢ƒè¦æ±‚
- **ComfyUI**: ç¡®ä¿å·²å®‰è£…å¹¶è¿è¡Œ ComfyUI
- **Python**: 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- **GPU**: æ¨è NVIDIA GPUï¼ˆæ”¯æŒ CUDAï¼‰

### ComfyUI è‡ªå®šä¹‰èŠ‚ç‚¹ï¼ˆå¯é€‰ï¼‰
å¦‚æœéœ€è¦ä½¿ç”¨å›¾ç‰‡åŠ å¯†åŠŸèƒ½ï¼Œéœ€è¦åœ¨ ComfyUI ä¸­å®‰è£…ä»¥ä¸‹è‡ªå®šä¹‰èŠ‚ç‚¹ï¼š

1. **å›¾åƒå‹ç¼©å™¨** (`image_compressor`)
   - ä½œç”¨ï¼šå‹ç¼©å’Œä¼˜åŒ–è¾“å…¥å›¾ç‰‡
   - å®‰è£…ä½ç½®ï¼š`ComfyUI/custom_nodes/image_compressor`

2. **å¸Œå°”ä¼¯ç‰¹å›¾åƒåŠ å¯†** (`hilbert_image_encrypt`)
   - ä½œç”¨ï¼šå¯¹ç”Ÿæˆçš„å›¾ç‰‡è¿›è¡ŒåŠ å¯†ä¿æŠ¤
   - å®‰è£…ä½ç½®ï¼š`ComfyUI/custom_nodes/hilbert_image_encrypt`

> âš ï¸ **é‡è¦æç¤º**ï¼šå¦‚æœå¼€å¯äº†å›¾ç‰‡è§£å¯†åŠŸèƒ½ï¼Œç”¨æˆ·éœ€è¦è‡ªè¡Œæœç´¢"å°ç•ªèŒ„å›¾ç‰‡æ··æ·†"å·¥å…·è¿›è¡Œè§£å¯†ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡
- **Python**: 3.8+ ï¼ˆæ¨è 3.10+ï¼‰
- **ComfyUI**: å·²å®‰è£…å¹¶è¿è¡Œçš„æœåŠ¡å™¨
- **AstrBot**: æœ€æ–°ç‰ˆæœ¬çš„æœºå™¨äººæ¡†æ¶

### 2. æ’ä»¶å®‰è£…
```bash
# å…‹éš†æ’ä»¶åˆ° Astrbot æ’ä»¶ç›®å½•
cd /path/to/astrbot/plugins
git clone https://github.com/tjc6666666666666/astrbot_plugin_ComfyUI_promax.git

# å®‰è£…ä¾èµ–
cd astrbot_plugin_ComfyUI_promax
pip install -r requirements.txt
```

### 3. åŸºç¡€é…ç½®
å¤åˆ¶å¹¶ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š
```bash
cp config.example.json config.json
# ç¼–è¾‘ config.json é…ç½®ä½ çš„ ComfyUI æœåŠ¡å™¨åœ°å€
```

### 4. å¯åŠ¨æ’ä»¶
```bash
# é‡å¯ Astrbot
python -m astrbot
```

æ’ä»¶å°†è‡ªåŠ¨åŠ è½½å¹¶è¿æ¥åˆ° ComfyUI æœåŠ¡å™¨ã€‚

### 5. éªŒè¯å®‰è£…
å‘é€ `aimg` æµ‹è¯•æ–‡ç”Ÿå›¾åŠŸèƒ½ï¼Œå¦‚çœ‹åˆ°å¸®åŠ©ä¿¡æ¯è¯´æ˜å®‰è£…æˆåŠŸã€‚

## ğŸ“ ä½¿ç”¨æŒ‡å—

### ğŸ¨ æ–‡ç”Ÿå›¾æŒ‡ä»¤
```
aimg <æç¤ºè¯> [å®½X,é«˜Y] [æ‰¹é‡N] [model:æè¿°] [lora:æè¿°[:å¼ºåº¦][!CLIPå¼ºåº¦]]
```

**ç¤ºä¾‹ï¼š**
```bash
# åŸºç¡€ç”¨æ³•
aimg ç¾å°‘å¥³

# å®Œæ•´å‚æ•°
aimg å¯çˆ±å¥³å­© å®½512,é«˜768 æ‰¹é‡2 model:å†™å®é£æ ¼ lora:å„¿ç«¥:0.8 lora:å¯çˆ±!1.0

# é«˜åˆ†è¾¨ç‡
aimg é£æ™¯ç”» å®½1024,é«˜768 æ‰¹é‡1 model:é£æ™¯é£æ ¼
```

### ğŸ–¼ï¸ å›¾ç”Ÿå›¾æŒ‡ä»¤
```
img2img <æç¤ºè¯> [å™ªå£°:æ•°å€¼] [æ‰¹é‡N] [model:æè¿°] [lora:æè¿°[:å¼ºåº¦][!CLIPå¼ºåº¦]] + å›¾ç‰‡
```

**ç¤ºä¾‹ï¼š**
```bash
# åŸºç¡€å›¾ç”Ÿå›¾
img2img çŒ«å’ª å™ªå£°:0.7

# å®Œæ•´å‚æ•°ï¼ˆéœ€è¦é™„å¸¦å›¾ç‰‡ï¼‰
img2img åŠ¨æ¼«è§’è‰² å™ªå£°:0.5 æ‰¹é‡2 model:åŠ¨æ¼«é£æ ¼ lora:è§’è‰²:1.2!0.9
```

### ğŸ”§ è‡ªå®šä¹‰ Workflow æŒ‡ä»¤
```
<å‰ç¼€> [å‚æ•°å:å€¼ ...] [+ å›¾ç‰‡ï¼ˆå¦‚éœ€è¦ï¼‰]
```

**ç¤ºä¾‹ï¼š**
```bash
# å›¾åƒåŠ å¯†
encrypt æ¨¡å¼:encrypt å¯ç”¨:true + å›¾ç‰‡

# å›¾åƒè§£å¯†
encrypt æ¨¡å¼:decrypt + åŠ å¯†å›¾ç‰‡

# å¹»å½±å¦å…‹ç”Ÿæˆï¼ˆé»‘ç™½æ¨¡å¼ï¼‰
å¹»å½±å¦å…‹ mode:gray param_a:5 param_b:5 + å›¾ç‰‡1 + å›¾ç‰‡2

# å¹»å½±å¦å…‹ç”Ÿæˆï¼ˆå½©è‰²æ¨¡å¼ï¼‰
å¹»å½±å¦å…‹ mode:color param_a:7 param_b:3 + å›¾ç‰‡1 + å›¾ç‰‡2

# Wan2.2 åŠ¨ç”»ç”Ÿæˆ
wan2.2 æç¤ºè¯:"A felt-style little eagle cashier greeting" æ€»å¸§æ•°:81 æœ€å®½:1024 æœ€é«˜:1280 + å›¾ç‰‡

# ä½¿ç”¨åˆ«å
encrypt mode:decrypt enable:false + å›¾ç‰‡
```

### ğŸ“¦ å‹ç¼©åŒ…ä¸‹è½½
```
comfyuioutput
```
è·å–ä»Šå¤©ç”Ÿæˆçš„æ‰€æœ‰å›¾ç‰‡çš„å‹ç¼©åŒ…ã€‚

### ğŸ“š å¸®åŠ©ä¿¡æ¯
```bash
aimg                    # æ–‡ç”Ÿå›¾å¸®åŠ©
img2img                 # å›¾ç”Ÿå›¾å¸®åŠ©
encrypt                 # å›¾åƒåŠ å¯†è§£å¯†å¸®åŠ©
å¹»å½±å¦å…‹                # å¹»å½±å¦å…‹ç”Ÿæˆå™¨å¸®åŠ©
wan2.2                  # Wan2.2åŠ¨ç”»ç”Ÿæˆå¸®åŠ©
Hunyuan3D              # æ··å…ƒ3Dç”Ÿæˆå¸®åŠ©
audio_ace_step_1_t2a_song  # éŸ³é¢‘è½¬åŠ¨ç”»å¸®åŠ©
```

## âš™ï¸ å‚æ•°è¯¦è§£

### ğŸ­ æ¨¡å‹é€‰æ‹©
- **æ ¼å¼**ï¼š`model:æè¿°`
- **ç¤ºä¾‹**ï¼š`model:å†™å®é£æ ¼`
- **è¯´æ˜**ï¼šæè¿°å¯¹åº”é…ç½®æ–‡ä»¶ä¸­çš„æ¨¡å‹æè¿°

### âœ¨ LoRA ä½¿ç”¨
- **åŸºç¡€æ ¼å¼**ï¼š`lora:æè¿°`ï¼ˆä½¿ç”¨é»˜è®¤å¼ºåº¦ 1.0/1.0ï¼‰
- **ä»…æ¨¡å‹å¼ºåº¦**ï¼š`lora:æè¿°:0.8`ï¼ˆstrength_model=0.8ï¼‰
- **ä»… CLIP å¼ºåº¦**ï¼š`lora:æè¿°!1.0`ï¼ˆstrength_clip=1.0ï¼‰
- **åŒå¼ºåº¦**ï¼š`lora:æè¿°:0.8!1.3`ï¼ˆmodel=0.8, clip=1.3ï¼‰
- **å¤š LoRA**ï¼šç©ºæ ¼åˆ†éš”å¤šä¸ª lora å‚æ•°

**ç¤ºä¾‹ï¼š**
```bash
lora:å„¿ç«¥ lora:å­¦ç”Ÿ:0.9 lora:å¯çˆ±!1.2
```

### ğŸ“ åˆ†è¾¨ç‡è®¾ç½®
- **æ ¼å¼**ï¼š`å®½X,é«˜Y` æˆ– `å®½,é«˜`
- **ç¤ºä¾‹**ï¼š`å®½512,é«˜768` æˆ– `512,768`
- **é™åˆ¶**ï¼š64~2000 åƒç´ èŒƒå›´

### ğŸ² å…¶ä»–å‚æ•°
- **æ‰¹é‡æ•°**ï¼š`æ‰¹é‡N`ï¼ˆN ä¸ºæ•°é‡ï¼Œæœ€å¤§ 6ï¼‰
- **å™ªå£°ç³»æ•°**ï¼š`å™ªå£°:æ•°å€¼`ï¼ˆ0.0~1.0ï¼Œé»˜è®¤ 0.7ï¼‰
- **ç§å­**ï¼š`ç§å­:æ•°å€¼`ï¼ˆ-1 ä¸ºéšæœºï¼‰

## ğŸ”§ é…ç½®è¯´æ˜

### ğŸŒ æœåŠ¡å™¨é…ç½®
```json
{
  "comfyui_url": ["http://127.0.0.1:8188,æœåŠ¡å™¨1", "http://192.168.1.100:8188,æœåŠ¡å™¨2"],
  "max_task_queue": 10,
  "max_failure_count": 3,
  "retry_delay": 300
}
```

### ğŸ¨ æ¨¡å‹é…ç½®
```json
{
  "model_config": [
    "v1-5-pruned-emaonly.safetensors,å†™å®é£æ ¼",
    "anime-model.safetensors,åŠ¨æ¼«é£æ ¼",
    "sd_xl_base_1.0.safetensors,SDXLåŸºç¡€"
  ]
}
```

## ğŸ“‹ Workflow å¼€å‘æŒ‡å—

### ğŸ—ï¸ Workflow ç›®å½•ç»“æ„
```
workflow/
â””â”€â”€ your_workflow/
    â”œâ”€â”€ config.json      # é…ç½®æ–‡ä»¶
    â”œâ”€â”€ workflow.json    # ComfyUI å·¥ä½œæµå®šä¹‰
    â””â”€â”€ help.png         # å¸®åŠ©å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰
```

### ğŸ“ é…ç½®æ–‡ä»¶ç¤ºä¾‹
```json
{
  "name": "å·¥ä½œæµåç§°",
  "prefix": "è°ƒç”¨å‰ç¼€",
  "description": "å·¥ä½œæµæè¿°",
  "version": "1.0.0",
  "author": "ä½œè€…åç§°",
  "input_nodes": ["51"],
  "output_nodes": ["9"],
  "configurable_nodes": ["31", "6"],
  "node_configs": {
    "31": {
      "seed": {
        "type": "number",
        "default": -1,
        "description": "éšæœºç§å­",
        "aliases": ["ç§å­", "random_seed"]
      },
      "sampler_name": {
        "type": "select",
        "default": "euler",
        "inject_samplers": true,
        "aliases": ["é‡‡æ ·å™¨", "sampler"]
      }
    }
  }
}
```

### ğŸ¯ å†…ç½® Workflow åˆ—è¡¨

| Workflow | å‰ç¼€ | åŠŸèƒ½æè¿° |
|---------|------|----------|
| å›¾åƒåŠ å¯†è§£å¯† | `encrypt` | å¸Œå°”ä¼¯ç‰¹æ›²çº¿å›¾åƒåŠ å¯†/è§£å¯† |
| å¹»å½±å¦å…‹ç”Ÿæˆå™¨ | `å¹»å½±å¦å…‹` | ç”Ÿæˆé»‘ç™½/å½©è‰²å¹»å½±å¦å…‹å›¾ç‰‡ |
| Wan2.2 | `wan2.2` | åŸºäºæ–‡æœ¬ç”ŸæˆåŠ¨ç”»åºåˆ— |
| Hunyuan3D | `Hunyuan3D` | è…¾è®¯æ··å…ƒ3Dæ¨¡å‹ç”Ÿæˆ |
| Audio Ace | `audio_ace_step_1_t2a_song` | éŸ³é¢‘é©±åŠ¨çš„åŠ¨ç”»ç”Ÿæˆ |

## ğŸ”§ é«˜çº§é…ç½®è¯¦è§£

### ğŸŒ Web API ä½¿ç”¨

#### å¯åŠ¨ Web API
```json
{
  "enable_web_api": true,
  "web_api_port": 7778,
  "web_api_allow_register": true
}
```

#### API ç«¯ç‚¹
- `POST /api/login` - ç”¨æˆ·ç™»å½•
- `POST /api/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/generate/txt2img` - æ–‡ç”Ÿå›¾
- `POST /api/generate/img2img` - å›¾ç”Ÿå›¾
- `GET /api/models` - è·å–æ¨¡å‹åˆ—è¡¨
- `GET /api/loras` - è·å– LoRA åˆ—è¡¨
- `GET /api/workflows` - è·å–å·¥ä½œæµåˆ—è¡¨

### ğŸ›ï¸ GUI ç®¡ç†ç•Œé¢

è®¿é—® `http://localhost:7777` è¿›å…¥é…ç½®ç®¡ç†ç•Œé¢ï¼š

- **æ¨¡å‹ç®¡ç†**ï¼šæ·»åŠ ã€åˆ é™¤ã€ç¼–è¾‘æ¨¡å‹é…ç½®
- **LoRA ç®¡ç†**ï¼šç®¡ç† LoRA æ¨¡å‹å’Œæè¿°
- **æœåŠ¡å™¨ç®¡ç†**ï¼šé…ç½® ComfyUI æœåŠ¡å™¨åˆ—è¡¨
- **ç”¨æˆ·ç®¡ç†**ï¼šæŸ¥çœ‹å’Œç®¡ç†æ³¨å†Œç”¨æˆ·
- **ç³»ç»Ÿç›‘æ§**ï¼šæŸ¥çœ‹æœåŠ¡å™¨çŠ¶æ€å’Œä»»åŠ¡é˜Ÿåˆ—

### ğŸ” å®‰å…¨åŠŸèƒ½

#### å›¾ç‰‡åŠ å¯†
- ä½¿ç”¨å¸Œå°”ä¼¯ç‰¹æ›²çº¿ç®—æ³•å¯¹å›¾ç‰‡è¿›è¡ŒåŠ å¯†
- æ”¯æŒåŠ å¯†å’Œè§£å¯†ä¸¤ç§æ¨¡å¼
- å¯é€‰æ‹©æ€§å¯ç”¨/ç¦ç”¨åŠ å¯†åŠŸèƒ½

#### è®¿é—®æ§åˆ¶
- ç¾¤èŠç™½åå•ï¼šé™åˆ¶ç‰¹å®šç¾¤èŠä½¿ç”¨
- æ—¶é—´æ®µæ§åˆ¶ï¼šè®¾ç½®æ’ä»¶å¼€æ”¾æ—¶é—´
- å¹¶å‘é™åˆ¶ï¼šæ§åˆ¶æ¯ä¸ªç”¨æˆ·çš„æœ€å¤§ä»»åŠ¡æ•°
- ä¸‹è½½é™åˆ¶ï¼šé™åˆ¶æ¯æ—¥ä¸‹è½½æ¬¡æ•°

### ğŸ“Š æ•°æ®ç®¡ç†

#### è‡ªåŠ¨ä¿å­˜
```
output/
â”œâ”€â”€ 2024/
â”‚   â”œâ”€â”€ 01/
â”‚   â”‚   â”œâ”€â”€ 15/
â”‚   â”‚   â”‚   â”œâ”€â”€ image_001.png
â”‚   â”‚   â”‚   â””â”€â”€ image_002.png
```

#### æ•°æ®åº“è®°å½•
- `user_downloads`ï¼šç”¨æˆ·ä¸‹è½½è®°å½•
- `image_records`ï¼šå›¾ç‰‡ç”Ÿæˆè®°å½•
- æ”¯æŒæŒ‰ç”¨æˆ·ã€æ—¥æœŸæŸ¥è¯¢å’Œç»Ÿè®¡

## ğŸš€ éƒ¨ç½²æŒ‡å—

### ğŸ³ Docker éƒ¨ç½²
```dockerfile
FROM python:3.10-slim

# å®‰è£…ä¾èµ–
COPY requirements.txt .
RUN pip install -r requirements.txt

# å¤åˆ¶æ’ä»¶æ–‡ä»¶
COPY . /app/WORKDIR /app

# å¯åŠ¨å‘½ä»¤
CMD ["python", "-m", "astrbot"]
```

### ğŸŒ Nginx åå‘ä»£ç†
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location /api/ {
        proxy_pass http://localhost:7778;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /gui/ {
        proxy_pass http://localhost:7777;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ComfyUI è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ ComfyUI æœåŠ¡çŠ¶æ€
curl http://localhost:8188/system_stats

# æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
telnet 127.0.0.1 8188
```

#### 2. Workflow åŠ è½½å¤±è´¥
- æ£€æŸ¥ `config.json` è¯­æ³•
- éªŒè¯ `workflow.json` æ ¼å¼
- æŸ¥çœ‹æ’ä»¶æ—¥å¿—é”™è¯¯ä¿¡æ¯

#### 3. å›¾ç‰‡ç”Ÿæˆå¤±è´¥
- æ£€æŸ¥æ¨¡å‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- éªŒè¯ LoRA æ–‡ä»¶è·¯å¾„
- ç¡®è®¤ ComfyUI æœåŠ¡å™¨èµ„æºå……è¶³

### æ—¥å¿—è°ƒè¯•
```bash
# æŸ¥çœ‹æ’ä»¶æ—¥å¿—
tail -f /path/to/astrbot.log | grep "ComfyUI"

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
export ASTRBOT_DEBUG=1
python -m astrbot
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¼€å‘ç¯å¢ƒæ­å»º
```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-repo/astrbot_plugin_ComfyUI_promax.git

# å®‰è£…å¼€å‘ä¾èµ–
pip install -r requirements-dev.txt

# è¿è¡Œæµ‹è¯•
pytest tests/
```

### Workflow å¼€å‘
1. åœ¨ `workflow/` ç›®å½•åˆ›å»ºæ–°æ–‡ä»¶å¤¹
2. ç¼–å†™ `config.json` é…ç½®æ–‡ä»¶
3. å¯¼å‡º ComfyUI å·¥ä½œæµä¸º `workflow.json`
4. æµ‹è¯•åŠŸèƒ½å¹¶æäº¤ PR



å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿æäº¤ Issue æˆ– Pull Requestï¼
```json
{
  "lora_config": [
    "child_lora.safetensors,å„¿ç«¥é£æ ¼",
    "old_man_lora.safetensors,è€äººé£æ ¼"
  ]
}
```

### ğŸŒ Web API é…ç½®
```json
{
  "enable_web_api": true,
  "web_api_port": 7778,
  "web_api_allow_register": true,
  "web_api_image_proxy": true
}
```

### ğŸ›ï¸ GUI ç®¡ç†ç•Œé¢é…ç½®
```json
{
  "enable_gui": true,
  "gui_port": 7777,
  "gui_username": "admin",
  "gui_password": "password"
}
```

### âš™ï¸ é«˜çº§åŠŸèƒ½é…ç½®
```json
{
  "enable_auto_recall": false,
  "auto_recall_delay": 20,
  "enable_fake_forward": false,
  "fake_forward_threshold": 2,
  "group_whitelist": ["123456789", "987654321"],
  "open_time_ranges": "7:00-8:00,11:00-14:00,17:00-24:00"
}
```

### ğŸ“ è‡ªåŠ¨ä¿å­˜é…ç½®
```json
{
  "enable_auto_save": true,
  "auto_save_directory": "output",
  "enable_output_zip": true,
  "daily_download_limit": 1,
  "only_own_images": true
}
```
```json
{
  "lora_config": [
    {
      "filename": "lora1.safetensors",
      "description": "å„¿ç«¥"
    },
    {
      "filename": "lora2.safetensors",
      "description": "å¯çˆ±"
    }
  ]
}
```

### ğŸ• æ—¶é—´é™åˆ¶
```json
{
  "open_time_ranges": "7:00-8:00,11:00-14:00,17:00-24:00"
}
```

## ğŸ”Œ Web é…ç½®ç•Œé¢

æ’ä»¶æä¾›äº†åŠŸèƒ½å¼ºå¤§çš„ Web é…ç½®ç®¡ç†ç•Œé¢ï¼Œæ”¯æŒå¯è§†åŒ–é…ç½®å’Œç®¡ç†ï¼š

### ğŸŒ è®¿é—®æ–¹å¼
- é»˜è®¤ç«¯å£ï¼š`8090`
- è®¿é—®åœ°å€ï¼š`http://localhost:8090`
- æ”¯æŒè¿œç¨‹è®¿é—®é…ç½®

### ğŸ“‹ åŠŸèƒ½ç‰¹æ€§
- **å·¥ä½œæµç®¡ç†**ï¼šæŸ¥çœ‹ã€ç¼–è¾‘ã€åˆ é™¤è‡ªå®šä¹‰å·¥ä½œæµ
- **æœåŠ¡å™¨é…ç½®**ï¼šåŠ¨æ€æ·»åŠ /åˆ é™¤ ComfyUI æœåŠ¡å™¨ï¼Œè®¾ç½®æƒé‡å’Œå¯ç”¨çŠ¶æ€
- **ä¸»é…ç½®ç®¡ç†**ï¼šå¯è§†åŒ–é…ç½®å„é¡¹å‚æ•°
- **å®æ—¶çŠ¶æ€ç›‘æ§**ï¼šæŸ¥çœ‹æœåŠ¡å™¨è¿æ¥çŠ¶æ€å’Œä»»åŠ¡é˜Ÿåˆ—
- **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒæ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡è®¿é—®

### ğŸ¨ ç•Œé¢é¢„è§ˆ
- **ç°ä»£åŒ– UI**ï¼šåŸºäº Bootstrap 5 çš„ç¾è§‚ç•Œé¢
- **ä¾§è¾¹æ å¯¼èˆª**ï¼šæ¸…æ™°çš„åŠŸèƒ½åˆ†ç±»
- **å¡ç‰‡å¼å¸ƒå±€**ï¼šç›´è§‚çš„ä¿¡æ¯å±•ç¤º
- **å®æ—¶åé¦ˆ**ï¼šæ“ä½œç»“æœå³æ—¶æ˜¾ç¤º

## ğŸ“Š é«˜çº§åŠŸèƒ½

### ğŸ“ˆ ä»»åŠ¡ç»Ÿè®¡ç³»ç»Ÿ
- **å®æ—¶ç»Ÿè®¡**ï¼šæ€»ä»»åŠ¡æ•°ã€æˆåŠŸç‡ã€å¤±è´¥ç‡
- **ç”¨æˆ·ç»Ÿè®¡**ï¼šæŒ‰ç”¨æˆ·åˆ†ç»„çš„ä»»åŠ¡ç»Ÿè®¡
- **æœåŠ¡å™¨ç»Ÿè®¡**ï¼šå„æœåŠ¡å™¨çš„è´Ÿè½½å’Œæ€§èƒ½ç»Ÿè®¡
- **æ€§èƒ½ç›‘æ§**ï¼šå¹³å‡å“åº”æ—¶é—´ã€é˜Ÿåˆ—é•¿åº¦ç›‘æ§
- **å¯è§†åŒ–æŠ¥è¡¨**ï¼šæ”¯æŒå›¾ç‰‡å½¢å¼çš„ç»Ÿè®¡æŠ¥å‘Š

### ğŸ”„ æ™ºèƒ½è´Ÿè½½å‡è¡¡
- **æƒé‡è½®è¯¢**ï¼šæ ¹æ®æœåŠ¡å™¨æƒé‡æ™ºèƒ½åˆ†é…ä»»åŠ¡
- **å¥åº·æ£€æŸ¥**ï¼šè‡ªåŠ¨æ£€æµ‹æœåŠ¡å™¨çŠ¶æ€ï¼Œæ•…éšœè‡ªåŠ¨åˆ‡æ¢
- **å¤±è´¥é‡è¯•**ï¼šæ”¯æŒå¤±è´¥é‡è¯•å’Œæ¢å¤æœºåˆ¶
- **åŠ¨æ€è°ƒæ•´**ï¼šæ ¹æ®æœåŠ¡å™¨æ€§èƒ½åŠ¨æ€è°ƒæ•´åˆ†é…ç­–ç•¥

### ğŸ›¡ï¸ ç”¨æˆ·æƒé™ç®¡ç†
- **ç™½åå•æœºåˆ¶**ï¼šä»…å…è®¸ç‰¹å®šç”¨æˆ·ä½¿ç”¨
- **é»‘åå•æœºåˆ¶**ï¼šç¦æ­¢ç‰¹å®šç”¨æˆ·ä½¿ç”¨
- **æƒé™åˆ†çº§**ï¼šä¸åŒç”¨æˆ·å¯é…ç½®ä¸åŒæƒé™
- **ä½¿ç”¨ç»Ÿè®¡**ï¼šè®°å½•ç”¨æˆ·ä½¿ç”¨é¢‘ç‡å’Œåå¥½

### ğŸ’¾ è‡ªåŠ¨å¤‡ä»½ç³»ç»Ÿ
- **å®šæ—¶å¤‡ä»½**ï¼šæ”¯æŒå®šæ—¶è‡ªåŠ¨å¤‡ä»½é…ç½®å’Œæ•°æ®
- **å¢é‡å¤‡ä»½**ï¼šä»…å¤‡ä»½å˜æ›´å†…å®¹ï¼ŒèŠ‚çœç©ºé—´
- **å¤‡ä»½ç®¡ç†**ï¼šè‡ªåŠ¨æ¸…ç†è¿‡æœŸå¤‡ä»½ï¼Œä¿æŒå­˜å‚¨ç©ºé—´
- **ä¸€é”®æ¢å¤**ï¼šæ”¯æŒå¿«é€Ÿæ¢å¤åˆ°æŒ‡å®šå¤‡ä»½ç‚¹

## ğŸ”Œ å¯æ‰©å±• Workflow ç³»ç»Ÿ

### ğŸŒŸ åŠŸèƒ½æ¦‚è¿°

æ’ä»¶æ”¯æŒå®Œå…¨å¯æ‰©å±•çš„ Workflow ç³»ç»Ÿï¼Œå…è®¸ç”¨æˆ·é€šè¿‡ç®€å•çš„é…ç½®æ–‡ä»¶åˆ›å»ºè‡ªå®šä¹‰çš„ ComfyUI å·¥ä½œæµï¼Œæ— éœ€ä¿®æ”¹ä¸»ä»£ç å³å¯æ— é™æ‰©å±•åŠŸèƒ½ã€‚

### ğŸ“ ç›®å½•ç»“æ„
```
workflow/
â”œâ”€â”€ encrypt/
â”‚   â”œâ”€â”€ config.json      # å·¥ä½œæµé…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ workflow.json    # ComfyUI å·¥ä½œæµå®šä¹‰
â”‚   â””â”€â”€ help.png         # è‡ªåŠ¨ç”Ÿæˆçš„å¸®åŠ©å›¾ç‰‡
â”œâ”€â”€ juxueli/
â”‚   â”œâ”€â”€ config.json
â”‚   â”œâ”€â”€ workflow.json
â”‚   â””â”€â”€ help.png
â””â”€â”€ your_workflow/
    â”œâ”€â”€ config.json
    â”œâ”€â”€ workflow.json
    â””â”€â”€ help.png
```

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

#### 1. æ¨¡å—åŒ–è®¾è®¡
- **ç‹¬ç«‹æ¨¡å—**ï¼šæ¯ä¸ª workflow éƒ½æ˜¯ç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—
- **çƒ­åŠ è½½**ï¼šé‡å¯æ’ä»¶åè‡ªåŠ¨åŠ è½½æ–°æ¨¡å—
- **é›¶ä»£ç æ‰©å±•**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶å³å¯æ·»åŠ æ–°åŠŸèƒ½

#### 2. çµæ´»çš„å‚æ•°ç³»ç»Ÿ
- **å¤šç§å‚æ•°ç±»å‹**ï¼štextã€numberã€booleanã€selectã€image
- **æ™ºèƒ½éªŒè¯**ï¼šè‡ªåŠ¨éªŒè¯å‚æ•°ç±»å‹ã€èŒƒå›´å’Œå¿…éœ€æ€§
- **åˆ«åæ”¯æŒ**ï¼šæ”¯æŒä¸­è‹±æ–‡å‚æ•°åå’Œè‡ªå®šä¹‰åˆ«å
- **é»˜è®¤å€¼**ï¼šä¸ºæ‰€æœ‰å‚æ•°æä¾›åˆç†çš„é»˜è®¤å€¼

#### 3. é…ç½®æ³¨å…¥åŠŸèƒ½
- **æ¨¡å‹æ³¨å…¥**ï¼šè‡ªåŠ¨åŒæ­¥ä¸»ç¨‹åºçš„æ¨¡å‹é…ç½®
- **LoRA æ³¨å…¥**ï¼šåŠ¨æ€æ˜¾ç¤ºå¯ç”¨çš„ LoRA åˆ—è¡¨
- **é‡‡æ ·å™¨æ³¨å…¥**ï¼šè‡ªåŠ¨ä½¿ç”¨ä¸»ç¨‹åºçš„é‡‡æ ·å™¨é…ç½®
- **è°ƒåº¦å™¨æ³¨å…¥**ï¼šè‡ªåŠ¨åŒæ­¥è°ƒåº¦å™¨è®¾ç½®

#### 4. æ™ºèƒ½å¸®åŠ©ç³»ç»Ÿ
- **è‡ªåŠ¨ç”Ÿæˆå¸®åŠ©**ï¼šæ¯ä¸ª workflow è‡ªåŠ¨ç”Ÿæˆè¯¦ç»†å¸®åŠ©æ–‡æ¡£
- **å›¾ç‰‡å¸®åŠ©**ï¼šæ”¯æŒç²¾ç¾çš„å›¾ç‰‡å½¢å¼å¸®åŠ©ï¼ˆä¸ä¸»å¸®åŠ©æ ·å¼ä¸€è‡´ï¼‰
- **å‚æ•°è¯´æ˜**ï¼šè¯¦ç»†çš„å‚æ•°ç±»å‹ã€èŒƒå›´å’Œç¤ºä¾‹è¯´æ˜
- **ç¼“å­˜æœºåˆ¶**ï¼šå¸®åŠ©å›¾ç‰‡è‡ªåŠ¨ç¼“å­˜ï¼Œæé«˜å“åº”é€Ÿåº¦

### ğŸ“‹ é…ç½®æ–‡ä»¶å®Œæ•´è§„èŒƒ

#### åŸºç¡€ä¿¡æ¯å­—æ®µ
```json
{
  "name": "å·¥ä½œæµæ˜¾ç¤ºåç§°",
  "prefix": "å‘½ä»¤å‰ç¼€",
  "description": "å·¥ä½œæµæè¿°",
  "version": "1.0.0",
  "author": "ä½œè€…",
  "input_mappings": {
    "6": {
      "positive_prompt": {
        "type": "text",
        "required": true,
        "description": "æ­£é¢æç¤ºè¯",
        "aliases": ["prompt", "æç¤ºè¯"]
      }
    }
  },
  "output_mappings": {
    "9": {
      "images": {
        "type": "image",
        "description": "ç”Ÿæˆçš„å›¾ç‰‡"
      }
    }
  },
  "configurable_nodes": [
    {
      "node_id": "6",
      "parameter": "positive_prompt"
    }
  ],
  "node_configs": {
    "6": {
      "width": {
        "type": "number",
        "required": false,
        "default": 512,
        "min": 64,
        "max": 2048,
        "description": "å›¾ç‰‡å®½åº¦",
        "aliases": ["w", "å®½åº¦"]
      },
      "height": {
        "type": "number",
        "required": false,
        "default": 512,
        "min": 64,
        "max": 2048,
        "description": "å›¾ç‰‡é«˜åº¦",
        "aliases": ["h", "é«˜åº¦"]
      },
      "steps": {
        "type": "number",
        "required": false,
        "default": 20,
        "min": 1,
        "max": 150,
        "description": "é‡‡æ ·æ­¥æ•°",
        "aliases": ["æ­¥æ•°"]
      },
      "sampler_name": {
        "type": "select",
        "required": false,
        "default": "euler",
        "options": ["euler", "euler_ancestral", "dpmpp_2m", "dpmpp_sde"],
        "inject_samplers": true,
        "description": "é‡‡æ ·å™¨",
        "aliases": ["sampler", "é‡‡æ ·å™¨"]
      },
      "ckpt_name": {
        "type": "select",
        "required": false,
        "default": "v1-5-pruned-emaonly.safetensors",
        "inject_models": true,
        "description": "æ¨¡å‹",
        "aliases": ["model", "æ¨¡å‹"]
      }
    }
  }
}
```

### ğŸ¨ å‚æ•°ç±»å‹è¯¦è§£

#### 1. æ–‡æœ¬ç±»å‹ (text)
```json
"parameter_name": {
  "type": "text",
  "required": true,
  "description": "å‚æ•°æè¿°",
  "aliases": ["åˆ«å1", "åˆ«å2"]
}
```

#### 2. æ•°å­—ç±»å‹ (number)
```json
"parameter_name": {
  "type": "number",
  "required": false,
  "default": 512,
  "min": 0,
  "max": 1000,
  "description": "å‚æ•°æè¿°",
  "aliases": ["åˆ«å1", "åˆ«å2"]
}
```

#### 3. å¸ƒå°”ç±»å‹ (boolean)
```json
"parameter_name": {
  "type": "boolean",
  "required": false,
  "default": true,
  "description": "å‚æ•°æè¿°",
  "aliases": ["å¼€å¯", "å…³é—­"]
}
```

#### 4. é€‰æ‹©ç±»å‹ (select)
```json
"parameter_name": {
  "type": "select",
  "required": false,
  "default": "option1",
  "options": ["option1", "option2", "option3"],
  "description": "å‚æ•°æè¿°",
  "aliases": ["åˆ«å1", "åˆ«å2"]
}
```

#### 5. å›¾ç‰‡ç±»å‹ (image)
```json
"parameter_name": {
  "type": "image",
  "required": true,
  "description": "å‚æ•°æè¿°",
  "aliases": ["å›¾ç‰‡", "image_input"]
}
```

### ğŸš€ é«˜çº§åŠŸèƒ½

#### é…ç½®æ³¨å…¥åŠŸèƒ½
é€šè¿‡ç‰¹æ®Šæ ‡è®°ï¼Œè®© workflow è‡ªåŠ¨åŒæ­¥ä¸»ç¨‹åºé…ç½®ï¼š

- **`"inject_models": true`**ï¼šè‡ªåŠ¨ä»ä¸»ç¨‹åºçš„ `model_config` åŠ è½½å¯ç”¨æ¨¡å‹
- **`"inject_loras": true`**ï¼šè‡ªåŠ¨æ˜¾ç¤ºå¯ç”¨çš„ LoRA åˆ—è¡¨å’Œæè¿°
- **`"inject_samplers": true`**ï¼šè‡ªåŠ¨ä½¿ç”¨ä¸»ç¨‹åºçš„é»˜è®¤é‡‡æ ·å™¨é…ç½®
- **`"inject_schedulers": true`**ï¼šè‡ªåŠ¨ä½¿ç”¨ä¸»ç¨‹åºçš„é»˜è®¤è°ƒåº¦å™¨é…ç½®

#### åˆ«åç³»ç»Ÿ
æ¯ä¸ªå‚æ•°éƒ½æ”¯æŒå¤šä¸ªåˆ«åï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ä»»ä½•åˆ«åï¼š

```json
{
  "width": {
    "aliases": ["w", "å®½åº¦", "image_width"]
  }
}
```

ç”¨æˆ·è°ƒç”¨æ–¹å¼ï¼š
- `width:800`
- `å®½åº¦:800`
- `w:800`
- `image_width:800`

### ğŸ“š å†…ç½® Workflow ç¤ºä¾‹

#### 1. å›¾åƒåŠ å¯†è§£å¯† (encrypt)
```bash
# åŠ å¯†å›¾ç‰‡
encrypt æ¨¡å¼:encrypt å¯ç”¨:true + å›¾ç‰‡

# è§£å¯†å›¾ç‰‡
encrypt mode:decrypt + åŠ å¯†å›¾ç‰‡

# ä½¿ç”¨åˆ«å
encrypt mode:decrypt enable:false + å›¾ç‰‡
```

#### 2. èšç†æ•ˆæœ (juxueli)
```bash
# åŸºç¡€èšç†æ•ˆæœ
juxueli å¼ºåº¦:0.8 + å›¾ç‰‡

# å®Œæ•´å‚æ•°
juxueli intensity:0.7 mode:enhance + å›¾ç‰‡
```

### ğŸ› ï¸ å¼€å‘æ–° Workflow

#### æ­¥éª¤ 1ï¼šåˆ›å»ºç›®å½•
```bash
mkdir workflow/your_workflow
cd workflow/your_workflow
```

#### æ­¥éª¤ 2ï¼šåˆ›å»ºé…ç½®æ–‡ä»¶ (config.json)
å‚è€ƒä¸Šé¢çš„å®Œæ•´è§„èŒƒåˆ›å»ºé…ç½®æ–‡ä»¶ã€‚

#### æ­¥éª¤ 3ï¼šè·å–å·¥ä½œæµå®šä¹‰
1. åœ¨ ComfyUI ä¸­è®¾è®¡ä½ çš„å·¥ä½œæµ
2. ç‚¹å‡» "Save (API Format)" ä¿å­˜ä¸º workflow.json
3. å°†æ–‡ä»¶æ”¾å…¥ä½ çš„ workflow ç›®å½•

#### æ­¥éª¤ 4ï¼šé‡å¯æ’ä»¶
é‡å¯ Astrbot æ’ä»¶ï¼Œæ–° workflow å°†è‡ªåŠ¨åŠ è½½ã€‚

#### æ­¥éª¤ 5ï¼šæµ‹è¯•åŠŸèƒ½
```bash
your_workflow --help  # æŸ¥çœ‹å¸®åŠ©
your_workflow å‚æ•°:å€¼ + å›¾ç‰‡  # æµ‹è¯•åŠŸèƒ½
```

### ğŸ¯ æœ€ä½³å®è·µ

1. **å‚æ•°è®¾è®¡**ï¼š
   - ä¸ºæ‰€æœ‰å‚æ•°æä¾›åˆç†çš„é»˜è®¤å€¼
   - ä½¿ç”¨æè¿°æ€§çš„å‚æ•°åå’Œåˆ«å
   - è®¾ç½®é€‚å½“çš„å‚æ•°èŒƒå›´é™åˆ¶

2. **é”™è¯¯å¤„ç†**ï¼š
   - æ˜ç¡®æ ‡è®°å¿…éœ€å‚æ•°
   - æä¾›è¯¦ç»†çš„å‚æ•°è¯´æ˜
   - ä½¿ç”¨å‚æ•°éªŒè¯é¿å…é”™è¯¯

3. **ç”¨æˆ·ä½“éªŒ**ï¼š
   - æä¾›ä¸­æ–‡åˆ«å
   - ç¼–å†™æ¸…æ™°çš„æè¿°
   - ä½¿ç”¨ä¸€è‡´çš„å‘½åè§„èŒƒ

4. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - åˆç†ä½¿ç”¨é…ç½®æ³¨å…¥
   - é¿å…ä¸å¿…è¦çš„å‚æ•°
   - ä¼˜åŒ–å·¥ä½œæµç»“æ„

### ğŸ’¾ å­˜å‚¨é…ç½®
```json
{
  "enable_auto_save": true,
  "auto_save_directory": "output",
  "enable_output_zip": true,
  "daily_download_limit": 3,
  "only_own_images": false
}
```

### ğŸ“š å¸®åŠ©ç³»ç»Ÿé…ç½®
```json
{
  "enable_help_image": true,
  "help_server_port": 8080
}
```

## ğŸŒ Web API æ¥å£

æ’ä»¶æä¾›äº†å®Œæ•´çš„ RESTful API æ¥å£ï¼Œæ”¯æŒç¬¬ä¸‰æ–¹é›†æˆï¼š

### ğŸ“‹ é…ç½®ç®¡ç† API
```http
GET    /api/config           # è·å–é…ç½®ä¿¡æ¯
POST   /api/config           # æ›´æ–°é…ç½®ä¿¡æ¯
GET    /api/servers          # è·å–æœåŠ¡å™¨åˆ—è¡¨
POST   /api/servers          # æ·»åŠ æœåŠ¡å™¨
DELETE /api/servers/{id}     # åˆ é™¤æœåŠ¡å™¨
```

### ğŸ¨ å·¥ä½œæµ API
```http
GET    /api/workflows        # è·å–å·¥ä½œæµåˆ—è¡¨
GET    /api/workflow/{id}    # è·å–ç‰¹å®šå·¥ä½œæµ
POST   /api/workflow         # åˆ›å»ºæ–°å·¥ä½œæµ
PUT    /api/workflow/{id}    # æ›´æ–°å·¥ä½œæµ
DELETE /api/workflow/{id}    # åˆ é™¤å·¥ä½œæµ
```

### ğŸ“Š ç»Ÿè®¡ä¿¡æ¯ API
```http
GET    /api/stats            # è·å–ç»Ÿè®¡ä¿¡æ¯
GET    /api/performance      # è·å–æ€§èƒ½æ•°æ®
GET    /api/health           # å¥åº·æ£€æŸ¥
```

### ğŸ’¾ å¤‡ä»½ç®¡ç† API
```http
GET    /api/backups          # è·å–å¤‡ä»½åˆ—è¡¨
POST   /api/backup           # åˆ›å»ºå¤‡ä»½
POST   /api/restore/{id}     # æ¢å¤å¤‡ä»½
DELETE /api/backup/{id}      # åˆ é™¤å¤‡ä»½
```

## ğŸ”Œ Workflow å¼€å‘

### ğŸ“ ç›®å½•ç»“æ„
```
workflow/
â”œâ”€â”€ encrypt/
â”‚   â”œâ”€â”€ config.json      # å·¥ä½œæµé…ç½®
â”‚   â”œâ”€â”€ workflow.json    # ComfyUI å·¥ä½œæµå®šä¹‰
â”‚   â””â”€â”€ help.png         # è‡ªåŠ¨ç”Ÿæˆçš„å¸®åŠ©å›¾ç‰‡
â””â”€â”€ your_workflow/
    â”œâ”€â”€ config.json
    â”œâ”€â”€ workflow.json
    â””â”€â”€ help.png
```

### ğŸ¯ å‚æ•°ç±»å‹æ”¯æŒ
- **text**: æ–‡æœ¬è¾“å…¥
- **number**: æ•°å€¼è¾“å…¥ï¼ˆæ”¯æŒ min/maxï¼‰
- **select**: ä¸‹æ‹‰é€‰æ‹©
- **boolean**: å¸ƒå°”å€¼
- **image**: å›¾ç‰‡è¾“å…¥

### ğŸš€ é«˜çº§å¼€å‘ç‰¹æ€§

#### 1. æ¡ä»¶å‚æ•°
æ”¯æŒæ ¹æ®å…¶ä»–å‚æ•°å€¼åŠ¨æ€æ˜¾ç¤º/éšè—å‚æ•°ï¼š
```json
{
  "conditional_parameters": {
    "mode": {
      "encrypt": ["key", "strength"],
      "decrypt": ["key"]
    }
  }
}
```

#### 2. å‚æ•°è”åŠ¨
æ”¯æŒå‚æ•°é—´çš„è”åŠ¨è®¡ç®—ï¼š
```json
{
  "parameter_dependencies": {
    "aspect_ratio": {
      "depends_on": ["width", "height"],
      "calculate": "width/height"
    }
  }
}
```

#### 3. è‡ªå®šä¹‰éªŒè¯
æ”¯æŒè‡ªå®šä¹‰å‚æ•°éªŒè¯è§„åˆ™ï¼š
```json
{
  "custom_validators": {
    "prompt": {
      "min_length": 10,
      "max_length": 1000,
      "forbidden_words": ["nsfw", "illegal"],
      "required_patterns": ["^[a-zA-Z0-9\\s\\u4e00-\\u9fa5]+$"]
    }
  }
}
```

#### 4. æ‰¹é‡å¤„ç†
æ”¯æŒæ‰¹é‡å¤„ç†å¤šä¸ªè¾“å…¥ï¼š
```json
{
  "batch_processing": {
    "enabled": true,
    "max_batch_size": 10,
    "parallel_processing": true
  }
}
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: æ’ä»¶æ— æ³•è¿æ¥åˆ° ComfyUI**
A: æ£€æŸ¥ ComfyUI æ˜¯å¦æ­£å¸¸è¿è¡Œï¼ŒURL é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œé˜²ç«å¢™è®¾ç½®æ˜¯å¦å…è®¸è¿æ¥ã€‚

**Q: ç”Ÿæˆçš„å›¾ç‰‡è´¨é‡ä¸ä½³**
A: å°è¯•è°ƒæ•´æç¤ºè¯ã€æ›´æ¢æ¨¡å‹ã€è°ƒæ•´ CFG å€¼æˆ–ä½¿ç”¨ LoRA å¢å¼ºã€‚

**Q: å¸®åŠ©å›¾ç‰‡æ— æ³•æ˜¾ç¤º**
A: æ£€æŸ¥ `enable_help_image` é…ç½®æ˜¯å¦ä¸º `true`ï¼Œç¡®ä¿æ’ä»¶æœ‰å†™å…¥æƒé™ã€‚

**Q: Workflow æ— æ³•ä½¿ç”¨**
A: æ£€æŸ¥ workflow ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ŒComfyUI æ˜¯å¦æœ‰å¯¹åº”çš„è‡ªå®šä¹‰èŠ‚ç‚¹ã€‚

### æ—¥å¿—æŸ¥çœ‹
æ’ä»¶è¿è¡Œæ—¥å¿—ä¼šè¾“å‡ºåˆ° Astrbot çš„æ—¥å¿—ç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹æ—¥å¿—æ¥è¯Šæ–­é—®é¢˜ã€‚

### è°ƒè¯•æ¨¡å¼
å¯ç”¨è°ƒè¯•æ¨¡å¼è·å–æ›´è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼š
```json
{
  "debug_mode": true,
  "log_level": "DEBUG",
  "enable_performance_logging": true
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### ğŸš€ æå‡ç”Ÿæˆé€Ÿåº¦
1. **å¤šæœåŠ¡å™¨éƒ¨ç½²**ï¼šé…ç½®å¤šä¸ª ComfyUI æœåŠ¡å™¨å®ç°è´Ÿè½½å‡è¡¡
2. **æ‰¹é‡ç”Ÿæˆ**ï¼šåˆç†è®¾ç½®æ‰¹é‡æ•°ï¼Œå‡å°‘è¯·æ±‚æ¬¡æ•°
3. **åˆ†è¾¨ç‡ä¼˜åŒ–**ï¼šæ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„åˆ†è¾¨ç‡
4. **æ™ºèƒ½è°ƒåº¦**ï¼šå¯ç”¨æ™ºèƒ½è·¯ç”±å’Œè´Ÿè½½å‡è¡¡
5. **ç¼“å­˜æœºåˆ¶**ï¼šåˆç†ä½¿ç”¨æ¨¡å‹å’Œ LoRA ç¼“å­˜

### ğŸ’¾ å­˜å‚¨ä¼˜åŒ–
1. **è‡ªåŠ¨æ¸…ç†**ï¼šå®šæœŸæ¸…ç†æ—§çš„ç”Ÿæˆå›¾ç‰‡
2. **å‹ç¼©è®¾ç½®**ï¼šè°ƒæ•´å›¾ç‰‡è´¨é‡å’Œå‹ç¼©æ¯”ä¾‹
3. **åˆ†å¸ƒå¼å­˜å‚¨**ï¼šå°†å­˜å‚¨ç›®å½•é…ç½®åˆ°é«˜é€Ÿç£ç›˜
4. **å¢é‡å¤‡ä»½**ï¼šä½¿ç”¨å¢é‡å¤‡ä»½å‡å°‘å­˜å‚¨å ç”¨
5. **äº‘å­˜å‚¨é›†æˆ**ï¼šæ”¯æŒå¯¹è±¡å­˜å‚¨æœåŠ¡

### ğŸ”§ ç³»ç»Ÿä¼˜åŒ–
1. **å†…å­˜ç®¡ç†**ï¼šåˆç†é…ç½®ä»»åŠ¡é˜Ÿåˆ—å¤§å°
2. **å¹¶å‘æ§åˆ¶**ï¼šæ ¹æ®ç¡¬ä»¶é…ç½®è°ƒæ•´å¹¶å‘æ•°
3. **ç½‘ç»œä¼˜åŒ–**ï¼šä½¿ç”¨ CDN åŠ é€Ÿå›¾ç‰‡ä¼ è¾“
4. **ç›‘æ§å‘Šè­¦**ï¼šè®¾ç½®æ€§èƒ½é˜ˆå€¼å’Œå‘Šè­¦æœºåˆ¶

## ğŸ¯ æœ€ä½³å®è·µ

### ğŸ“‹ éƒ¨ç½²å»ºè®®
1. **ç¡¬ä»¶é…ç½®**ï¼šæ¨èä½¿ç”¨ NVIDIA GPUï¼Œæ˜¾å­˜è‡³å°‘ 8GB
2. **æœåŠ¡å™¨è§„åˆ’**ï¼šæ ¹æ®ç”¨æˆ·é‡é…ç½®åˆé€‚æ•°é‡çš„ ComfyUI æœåŠ¡å™¨
3. **ç½‘ç»œæ¶æ„**ï¼šä½¿ç”¨å†…ç½‘é€šä¿¡ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿ
4. **å®‰å…¨è®¾ç½®**ï¼šé…ç½®é˜²ç«å¢™å’Œè®¿é—®æ§åˆ¶

### ğŸ¨ ä½¿ç”¨æŠ€å·§
1. **æç¤ºè¯ä¼˜åŒ–**ï¼šä½¿ç”¨ç»“æ„åŒ–æç¤ºè¯è·å¾—æ›´å¥½æ•ˆæœ
2. **æ¨¡å‹é€‰æ‹©**ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ¨¡å‹å’Œ LoRA
3. **å‚æ•°è°ƒä¼˜**ï¼šé€šè¿‡å®éªŒæ‰¾åˆ°æœ€ä½³å‚æ•°ç»„åˆ
4. **æ‰¹é‡å¤„ç†**ï¼šåˆç†åˆ©ç”¨æ‰¹é‡ç”Ÿæˆæé«˜æ•ˆç‡

### ğŸ› ï¸ ç»´æŠ¤ç®¡ç†
1. **å®šæœŸå¤‡ä»½**ï¼šè®¾ç½®è‡ªåŠ¨å¤‡ä»½ç­–ç•¥
2. **æ€§èƒ½ç›‘æ§**ï¼šå®šæœŸæ£€æŸ¥ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
3. **æ—¥å¿—åˆ†æ**ï¼šé€šè¿‡æ—¥å¿—åˆ†æå‘ç°é—®é¢˜
4. **ç‰ˆæœ¬ç®¡ç†**ï¼šä¿æŒæ’ä»¶å’Œä¾èµ–çš„ç‰ˆæœ¬æ›´æ–°

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### ğŸ› æŠ¥å‘Šé—®é¢˜
- ä½¿ç”¨ Issue æ¨¡æ¿æŠ¥å‘Š bug
- æä¾›è¯¦ç»†çš„å¤ç°æ­¥éª¤
- é™„ä¸Šç›¸å…³çš„æ—¥å¿—å’Œé…ç½®ä¿¡æ¯
- è¯´æ˜è¿è¡Œç¯å¢ƒï¼ˆç³»ç»Ÿã€Pythonç‰ˆæœ¬ç­‰ï¼‰

### ğŸ’¡ åŠŸèƒ½å»ºè®®
- åœ¨ Issue ä¸­æè¿°æ–°åŠŸèƒ½éœ€æ±‚
- è¯´æ˜ä½¿ç”¨åœºæ™¯å’Œé¢„æœŸæ•ˆæœ
- æä¾›å¯èƒ½çš„å®ç°æ€è·¯
- è®¨è®ºæŠ€æœ¯å¯è¡Œæ€§

### ğŸ”§ ä»£ç è´¡çŒ®
1. Fork é¡¹ç›®åˆ°ä½ çš„ GitHub
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ï¼š`git checkout -b feature/new-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add new feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/new-feature`
5. åˆ›å»º Pull Request

### ğŸ“ æ–‡æ¡£æ”¹è¿›
- ä¿®æ­£æ–‡æ¡£ä¸­çš„é”™è¯¯
- è¡¥å……ç¼ºå¤±çš„ä½¿ç”¨è¯´æ˜
- ç¿»è¯‘æ–‡æ¡£åˆ°å…¶ä»–è¯­è¨€
- æ·»åŠ æ›´å¤šç¤ºä¾‹å’Œæœ€ä½³å®è·µ

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®å’Œè´¡çŒ®è€…ï¼š

- [ComfyUI](https://github.com/comfyanonymous/ComfyUI) - å¼ºå¤§çš„ AI ç»˜å›¾å·¥å…·
- [AstrBot](https://github.com/yourusername/astrbot) - ä¼˜ç§€çš„èŠå¤©æœºå™¨äººæ¡†æ¶
- æ‰€æœ‰è´¡çŒ®è€…å’Œç”¨æˆ·çš„æ”¯æŒä¸åé¦ˆ

## ğŸ“ è”ç³»æ–¹å¼

- **é¡¹ç›®ä¸»é¡µ**: [GitHub Repository](https://github.com/tjc6666666666666/astrbot_plugin_ComfyUI_promax)
- **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/tjc6666666666666/astrbot_plugin_ComfyUI_promax/issues)
- **è®¨è®ºäº¤æµ**: [GitHub Discussions](https://github.com/tjc6666666666666/astrbot_plugin_ComfyUI_promax/discussions)


<div align="center">



[![Star](https://img.shields.io/github/stars/tjc6666666666666/astrbot_plugin_ComfyUI_promax.svg?style=social&label=Star)](https://github.com/tjc6666666666666/astrbot_plugin_ComfyUI_promax)
[![Fork](https://img.shields.io/github/forks/tjc6666666666666/astrbot_plugin_ComfyUI_promax.svg?style=social&label=Fork)](https://github.com/tjc6666666666666/astrbot_plugin_ComfyUI_promax/fork)

</div>
